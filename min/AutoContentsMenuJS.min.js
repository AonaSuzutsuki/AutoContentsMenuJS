/*! 
    AutoContentsMenuJS    Copyright (C) AonaSuzutsuki 2020.
    MIT License
*/

function Stack(){const e=[];this.push=(t=>(t=>e.push(t))(t)),this.pop=(()=>e.length<=0?null:e.pop()),this.each=(t=>e.forEach((e,n)=>t(e))),this.reduce=(t=>e.reduce((e,n)=>t(e,n)))}function Queue(){const e=[],t=t=>e.push(t);this.enqueueRange=(e=>{for(let[n,l]of Object.entries(e))t(l)}),this.enqueue=(e=>t(e)),this.dequeue=(()=>e.length<=0?null:e.shift()),this.get=(()=>item=e.length<0?null:e[0])}function AutoContentsMenuJS(){const e={H1:0,H2:1,H3:2,H4:3,H5:4,H6:5};let t=null,n=null,l="",s="";const i=(t,n,l,s)=>{const r=n.pop(),u=r[0];let o=r[1];const c=t.dequeue(),a=(e=>e.reduce((e,t)=>e+t))(l),h=document.createElement("li"),d=c.getAttribute("id"),p=s?`${a}${o} ${c.innerText}`:c.innerText;h.appendChild(((e,t)=>{const n=document.createElement("a");return n.setAttribute("href",e),n.innerText=t,n})(`#${d}`,p)),u.appendChild(h),n.push([u,o+1]);const m=t.get();if(null!=m){const r=e[m.tagName],a=e[c.tagName];if(r>a){const e=document.createElement("ol");n.push([e,1]),u.appendChild(e),l.push(`${o}.`),i(t,n,l,s)}else if(r===a)i(t,n,l,s);else{const e=a-r;for(let t=0;t<e;t++)n.pop(),l.pop();i(t,n,l,s)}}},r=l=>{let r=document.querySelectorAll(`${t}, h1, h2, h3, h4, h5, h6`);if(n){r=((e,t)=>{let n=Array.from(e),l=Array.from(t);return n.filter(e=>!l.includes(e))})(r,document.querySelectorAll(n))}(t=>{const n={};Array.from(document.body.getElementsByTagName("*")).forEach(e=>{const t=e.getAttribute("id");void 0!==t&&(n[t]=t in n?n[t]+1:0)}),t.forEach((t,l)=>{if(t.tagName in e){const e=t.getAttribute("id");if(null==e){const e=t.innerText;if(e in n){let l=n[e];t.setAttribute("id",`${e}_${++l}`),n[e]=l}else t.setAttribute("id",e),n[e]=0}else n[e]=e in n?n[e]+1:0}})})(r);const u=(t=>{const n=[];let l=[];return t.forEach((t,s)=>{t.tagName in e?l.push(t):(l=[],n[n.length]=[t,l])}),0==n.length&&(n[0]=[null,l]),n})(r),o=document.createElement("div");s&&(o.className=s);let c=1;for(let[e,t]of Object.entries(u)){const e=t[0];if(null!=e){let t=document.createElement("div");t.innerText=e.innerText,t.className=`content-title title-${String(c++)}`,o.appendChild(t)}const n=document.createElement("ol"),s=new Stack;s.push([n,1]);const r=new Queue;r.enqueueRange(t[1]);const u=new Stack;u.push(""),i(r,s,u,l),o.appendChild(n)}return o};this.drawContentsMenu=((e,t=!1,n="目次")=>{const s=r(t);let i=document.querySelector(e);i.appendChild((e=>{let t=document.createElement("h3");return t.className=l,t.innerText=e,t})(n)),i.appendChild(s)}),this.registerGroup=(e=>t=e),this.ignoreClass=(e=>n=e),this.registerGroupClass=(e=>l=e),this.registerContainerClass=(e=>s=e)}
