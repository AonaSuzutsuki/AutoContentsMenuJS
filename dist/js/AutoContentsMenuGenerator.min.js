/*@license 
    AutoContentsMenuJS    Copyright (C) AonaSuzutsuki 2020.
    v1.0

    MIT License
*/
class AutoContentsMenuGenerator{constructor(){this._hierarchyMap={H1:0,H2:1,H3:2,H4:3,H5:4,H6:5},this._className=null,this._ignoreClassNmae=null,this._addedClassName="",this._containerClassName=""}static createContentName(e){let t=document.createElement("h3");return t.className=this._addedClassName,t.innerText=e,t}static createLink(e,t){const n=document.createElement("a");return n.setAttribute("href",e),n.innerText=t,n}static createParentString(e){return e.reduce((e,t)=>e+t)}appendMenuElements(e,t,n,r){const a=t.pop(),s=a[0];let i=a[1];const l=e.dequeue(),o=AutoContentsMenuGenerator.createParentString(n),c=document.createElement("li"),u=l.getAttribute("id"),h=r?`${o}${i} ${l.innerText}`:l.innerText;c.appendChild(AutoContentsMenuGenerator.createLink(`#${u}`,h)),s.appendChild(c),t.push([s,i+1]);const d=e.get();if(null!=d){const a=this._hierarchyMap[d.tagName],o=this._hierarchyMap[l.tagName];if(a>o){const a=document.createElement("ol");t.push([a,1]),s.appendChild(a),n.push(`${i}.`),this.appendMenuElements(e,t,n,r)}else if(a===o)this.appendMenuElements(e,t,n,r);else{const s=o-a;for(let e=0;e<s;e++)t.pop(),n.pop();this.appendMenuElements(e,t,n,r)}}}allocHeadId(e){const t={};Array.from(document.body.getElementsByTagName("*")).forEach(e=>{const n=e.getAttribute("id");void 0!==n&&(t[n]=n in t?t[n]+1:0)}),e.forEach((e,n)=>{if(e.tagName in this._hierarchyMap){const n=e.getAttribute("id");if(null==n){const n=e.innerText;if(n in t){let r=t[n];e.setAttribute("id",`${n}_${++r}`),t[n]=r}else e.setAttribute("id",n),t[n]=0}else t[n]=n in t?t[n]+1:0}})}separateGroup(e){const t=[];let n=[];return e.forEach((e,r)=>{e.tagName in this._hierarchyMap?n.push(e):(n=[],t[t.length]=[e,n])}),0==t.length&&(t[0]=[null,n]),t}removeIgnoreClass(e,t){let n=Array.from(e),r=Array.from(t);return n.filter(e=>!r.includes(e))}createContentsMenu(e){let t=document.querySelectorAll(`${this._className}, h1, h2, h3, h4, h5, h6`);if(this._ignoreClassNmae){let e=document.querySelectorAll(this._ignoreClassNmae);t=this.removeIgnoreClass(t,e)}this.allocHeadId(t);const n=this.separateGroup(t),r=document.createElement("div");this._containerClassName&&(r.className=this._containerClassName);let a=1;for(let[t,s]of Object.entries(n)){const t=s[0];if(null!=t){let e=document.createElement("div");e.innerText=t.innerText,e.className=`content-title title-${String(a++)}`,r.appendChild(e)}const n=document.createElement("ol"),i=new Stack;i.push([n,1]);const l=new Queue;l.enqueueRange(s[1]);const o=new Stack;o.push(""),this.appendMenuElements(l,i,o,e),r.appendChild(n)}return r}drawContentsMenu(e,t=!1,n="目次"){const r=this.createContentsMenu(t);let a=document.querySelector(e);a.appendChild(AutoContentsMenuGenerator.createContentName(n)),a.appendChild(r)}registerGroup(e){this._className=e}ignoreClass(e){this._ignoreClassNmae=e}registerGroupClass(e){this._addedClassName=e}registerContainerClass(e){this._containerClassName=e}}class Stack{constructor(){this.array=[]}push(e){this.array.push(e)}pop(){return this.array.length<=0?null:this.array.pop()}each(e){this.array.forEach((t,n)=>e(t))}reduce(e){return this.array.reduce((t,n)=>e(t,n))}}class Queue{constructor(){this.array=[]}enqueue(e){this.array.push(e)}enqueueRange(e){for(let[t,n]of Object.entries(e))this.enqueue(n)}dequeue(){return this.array.length<=0?null:this.array.shift()}get(){return this.array.length<0?null:this.array[0]}}