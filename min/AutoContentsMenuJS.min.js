/*! 
    AutoMenu    Copyright (C) AonaSuzutsuki 2020.
    MIT License
*/

function Stack(){const e=[];this.push=(t=>(t=>e.push(t))(t)),this.pop=(()=>e.length<=0?null:e.pop()),this.each=(t=>e.forEach((e,n)=>t(e)))}function Queue(){const e=[],t=t=>e.push(t);this.enqueueRange=(e=>{for(let[n,s]of Object.entries(e))t(s)}),this.enqueue=(e=>t(e)),this.dequeue=(()=>e.length<=0?null:e.shift()),this.get=(()=>item=e.length<0?null:e[0])}function AutoContentsMenuJS(){const e={H1:0,H2:1,H3:2,H4:3,H5:4,H6:5};let t=null,n=null,s="",l="";const i=(t,n,s,l)=>{const o=n.pop(),r=o[0];let u=o[1];const c=t.dequeue(),a=(e=>{let t="";return e.each(e=>{t+=e}),t})(s),h=document.createElement("li"),d=c.getAttribute("id"),p=l?`${a}${u} ${c.innerText}`:c.innerText;h.appendChild(((e,t)=>{const n=document.createElement("a");return n.setAttribute("href",e),n.innerText=t,n})(`#${d}`,p)),r.appendChild(h),n.push([r,u+1]);const m=t.get();if(null!=m){const o=e[m.tagName],a=e[c.tagName];if(o>a){const e=document.createElement("ol");n.push([e,1]),r.appendChild(e),s.push(`${u}.`),i(t,n,s,l)}else if(o===a)i(t,n,s,l);else{const e=a-o;for(let t=0;t<e;t++)n.pop(),s.pop();i(t,n,s,l)}}},o=s=>{let o=document.querySelectorAll(`${t}, h1, h2, h3, h4, h5, h6`);n&&(r=o,o=Array.from(r).filter(e=>!e.classList.contains(n))),(t=>{const n={};Array.from(document.body.getElementsByTagName("*")).forEach(e=>{const t=e.getAttribute("id");void 0!==t&&(n[t]=t in n?n[t]+1:0)}),t.forEach((t,s)=>{if(t.tagName in e){const e=t.getAttribute("id");if(null==e){const e=t.innerText;if(e in n){let s=n[e];t.setAttribute("id",`${e}_${++s}`),n[e]=s}else t.setAttribute("id",e),n[e]=0}else n[e]=e in n?n[e]+1:0}})})(o);const u=(t=>{const n=[];let s=[];return t.forEach((t,l)=>{t.tagName in e?s.push(t):(s=[],n[n.length]=[t,s])}),0==n.length&&(n[0]=[null,s]),n})(o),c=document.createElement("div");l&&(c.className=l);let a=1;for(let[e,t]of Object.entries(u)){const e=t[0];if(null!=e){let t=document.createElement("div");t.innerText=e.innerText,t.className=`content-title title-${String(a++)}`,c.appendChild(t)}const n=document.createElement("ol"),l=new Stack;l.push([n,1]);const o=new Queue;o.enqueueRange(t[1]);const r=new Stack;r.push(""),i(o,l,r,s),c.appendChild(n)}return c};var r;this.drawContentsMenu=((e,t=!1,n="目次")=>{const l=o(t);let i=document.querySelector(e);i.appendChild((e=>{let t=document.createElement("h3");return t.className=s,t.innerText=e,t})(n)),i.appendChild(l)}),this.registerGroup=(e=>t=e),this.ignoreClass=(e=>n=e),this.registerGroupClass=(e=>s=e),this.registerContainerClass=(e=>l=e)}
